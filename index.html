<Module>
  <ModulePrefs title="Google.com"/>
  <Content type="html">
    <![CDATA[
    <!DOCTYPE html>
    <html lang="en-us">
      <head>
        <meta charset="utf-8"/>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/centerclassroom/ola@main/style.css"/>
        <!-- Yandex Games SDK -->

        <style>
          canvas:focus { outline: none; }

          html, body {
            padding: 0;
            margin: 0;
            overflow: hidden;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
            height: 100%;
          }
        </style>
      </head>

      <body class="dark">
        <div id="unity-container" class="unity-desktop">
          <canvas id="unity-canvas" tabindex="-1"></canvas>
        </div>

        <div id="loading-cover" style="display:none;">
          <div id="unity-loading-bar">
            <div id="unity-logo"></div>
            <div id="unity-progress-bar-empty" style="display: none;">
              <div id="unity-progress-bar-full"></div>
            </div>
            <div class="spinner"></div>
          </div>
        </div>

        <script>
          const buildUrl = "https://cdn.jsdelivr.net/gh/centerclassroom/ola@main/Build";
          const loaderUrl = buildUrl + "/Build.loader.js";
          const cdnBaseUrl = "https://cdn.jsdelivr.net/gh/centerclassroom/ola@main/";

          const dataParts = [
            cdnBaseUrl + "Build.data.br.part0",
            cdnBaseUrl + "Build.data.br.part1",
            cdnBaseUrl + "Build.data.br.part2",
            cdnBaseUrl + "Build.data.br.part3"
          ];

          const wasmParts = [
            cdnBaseUrl + "Build.wasm.br.part0",
            cdnBaseUrl + "Build.wasm.br.part1",
            cdnBaseUrl + "Build.wasm.br.part2",
            cdnBaseUrl + "Build.wasm.br.part3",
            cdnBaseUrl + "Build.wasm.br.part4"
          ];

          async function fetchAndCombineParts(partUrls) {
            const buffers = [];
            for (const url of partUrls) {
              const response = await fetch(url);
              if (!response.ok) throw new Error(`Failed to fetch ${url}`);
              const buffer = await response.arrayBuffer();
              buffers.push(buffer);
            }
            const totalLength = buffers.reduce((sum, buf) => sum + buf.byteLength, 0);
            const combined = new Uint8Array(totalLength);
            let offset = 0;
            for (const buffer of buffers) {
              combined.set(new Uint8Array(buffer), offset);
              offset += buffer.byteLength;
            }
            return new Blob([combined], { type: 'application/octet-stream' });
          }

          const config = {
            dataUrl: "",
            frameworkUrl: buildUrl + "/Build.framework.js",
            codeUrl: "",
            streamingAssetsUrl: "StreamingAssets",
            companyName: "DefaultCompany",
            productName: "99Days",
            productVersion: "0.1"
          };

          const container = document.querySelector("#unity-container");
          const canvas = document.querySelector("#unity-canvas");
          const loadingCover = document.querySelector("#loading-cover");
          const progressBarEmpty = document.querySelector("#unity-progress-bar-empty");
          const progressBarFull = document.querySelector("#unity-progress-bar-full");
          const spinner = document.querySelector('.spinner');

          if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
            container.className = "unity-mobile";
          }

          loadingCover.style.display = "";

          document.addEventListener('contextmenu', event => event.preventDefault());

          function FocusGame() {
            window.focus();
            canvas.focus();
          }

          window.addEventListener('pointerdown', FocusGame);
          window.addEventListener('touchstart', FocusGame);

          let StartUnityInstance;
          let myGameInstance;
          let initGame = false;

          try {
            const script = document.createElement("script");
            script.src = loaderUrl;
            script.onload = async () => {
              const dataBlob = await fetchAndCombineParts(dataParts);
              const wasmBlob = await fetchAndCombineParts(wasmParts);
              config.dataUrl = URL.createObjectURL(dataBlob);
              config.codeUrl = URL.createObjectURL(wasmBlob);

              StartUnityInstance = function () {
                createUnityInstance(canvas, config, (progress) => {
                  spinner.style.display = "none";
                  progressBarEmpty.style.display = "";
                  progressBarFull.style.width = `${100 * progress}%`;
                }).then((unityInstance) => {
                  myGameInstance = unityInstance;
                  loadingCover.style.display = "none";
                }).catch((message) => {
                  console.error("Unity yükleme hatası:", message);
                });
              };
              StartUnityInstance();
            };
            document.body.appendChild(script);
          } catch (error) {
            console.error("Başlatma sırasında hata:", error);
          }

          function InitGame() {
            try {
              console.log('Init Game Success');
              initGame = true;
            } catch (error) {
              console.error("InitGame sırasında hata:", error);
            }
          }

          window.addEventListener("unhandledrejection", function(event) {
            console.warn("Hata es geçildi:", event.reason);
            event.preventDefault();
          });
        </script>
      </body>
    </html>
    ]]>
  </Content>
</Module>
